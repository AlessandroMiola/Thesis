\chapter{Privacy and fungibility issues in Bitcoin}
\label{chpr:priv_fung}
Traditional, centralized financial institutions provide a level of privacy in their systems with respect to the outside world which is necessary for personal and commercial reasons at first (to preserve the freedom to transact, not to let commercial competitors monitor your own activity). The obvious concern, however, is that this level of privacy is not guaranteed against the same institutions providing the service and this opens a lot of issues regarding data collection and data privacy. \\
Bitcoin's breakthrough to have succeeded in building a decentralized distributed network where distributed consensus is reached among the nodes of the network themselves has put some constraints on the underlying security model which seem to conflict with the privacy issues addressed above. Though, observe that this is quite unavoidable: whereas decentralized systems are easy to build without consensus and, on the other hand, consensus is easy to achieve in centralized systems, maintaining both properties in the same system proves to be a hard challenge.\\ 
Bitcoin's security model is based on the achievement of distributed consensus which in turn requires (among the others) universal and independent verification of the validity of each transaction, made possible by having public transaction data. That is, transparency is needed to obtain and strengthen security.\\
This lack of privacy is recognized to be a weak point within the Bitcoin's protocol and several proposals to improve different aspects of privacy in Bitcoin have appeared in the years, despite never being effectively softforked. The main reason for this being basically the high costs that the massive adoption for privacy-based solutions would imply: privacy is costly and requires commitments. Nevertheless, advances in monitoring capabilities of the blockchain, newborn businesses in Bitcoin blockchain's analysis urge the need for privacy-based solutions in the long run.\\
The original protocol has addressed the problem mainly through the adoption of pseudonymous addresses, that on one hand seem robust if one does not know who owns which addresses, but suffer both from some unsafe users practices (like address reuse) and from the possibility to exploit coins linkability\footnote{The need of a user to generally spend the change back to himself when transacting (due to transaction outputs generally not embedding the right value to be spent in a successive transaction) basically links transaction outputs and so addresses. Moreover in case previously collected changes are too small to cover a transaction output in its entirety, this makes it necessary to combine changes and so further linking transactions.} to trace the transaction graph.\\
Instead, a point in favour of having less privacy and more transparency comes from whom is mainly concerned with the use of cryptocurrencies like bitcoin for illicit activities, who argues that this could be a feature that can help investigations.
\section{Types of privacy in Bitcoin}
Due to how the Bitcoin's protocol has been conceived and implemented, the aim to strengthen privacy should regard different aspects whose improvement can be beneficial. In particular, the concern should be on \textit{association} privacy, \textit{balance} privacy, \textit{identity} privacy and \textit{transaction value} privacy.\\
Improving association privacy would mean enhancing transaction graph privacy not letting the possibility to understand who is paying who, thus addressing the previously discussed linkage between transactions and so making transaction graph analysis harder. A typical practice undermining it is address reuse, that is however nowadays reduced by wallets using a Hierarchical Deterministic derivation of keys (and so addresses). Moreover, different solutions have been proposed in this field in the years. One of the first, Coinjoin \cite{Max13}, exploits the absence of a mapping between inputs and outputs in a transaction or better the \textit{many-to-many} mapping existing between them (in a transaction with more than one input, it is not possible to say which input ends up being which of the output or which part of) to create a single transaction jointly authored\footnote{All of the transaction inputs are shuffled among several participants, each signing their input and output only.} by several participants in such a way that they do not have to trust each other and it is not possible to correlate inputs and outputs.\\ Another solution which even provides association privacy, although was not born primarily for this purpose, is certainly Lightning \cite{RefWork:18}, whose gain in transaction graph privacy derives for instance from the possibility of the parties taking part to a multi-hop channel to basically transact without sending data to the blockchain. \\ \ \\
...aggiungi anche tumblebit, Ring Signatures?\\ \ \\
Improving balance privacy, instead, should aim at protecting against the possibility of deducing the balance of a wallet. \\ \ \\
Achieving identity privacy refers to the possibility of each user to prevent his identity to be associated with the coins.\\ \ \\
The last privacy aspect which deserves credit is transaction value privacy, which actually is the main concern of the Confidential Transactions \cite{Max15} solution. The idea is to protect against other people knowing the value of everyone's transactions, which is kind of standard for traditional financial services. That is, it affects the \textit{confidentiality} Bitcoin transactions lack at all. Some concrete examples could stress the need for such improvements. For instance, a common implication for employees of a company paying wages in bitcoin is that they'll have their wages public, which is not that nice. Another possible example where amount privacy turns to be necessary, though less conflicting common bitcoins' owners, configures when somebody's wallet spends a large sized input for a small payment, thus paying back to itself a high change; in this case, the possibility of being targeted for theft would be at least real.
\subsection{Confidential transactions address value privacy}
\subsection{Compatibility with different solutions}
spiegare problemi di coinjoin (anche necessit√† outputs di stessa  size) e come si lega a CT
\section{Fungibility}
It turns out fungibility being quite relevant in this discussion. Thus, we can start explaining what fungibility is. Fungibility is the property of a unit of a good to be completely interchangeable from any other unit of the same good (or at least treated as such). To give some examples, diamonds are not completely fungible\footnote{Gold is much more fungible.}: little differences in their properties (cut, hardness, color etc.) make it difficult to find diamonds expected to be equally valued. Another possible example of non-fungible good is a piece of art as it is clearly not possible to exchange one for one other.\\
For what concerns currencies, fungibility is a crucial property: we do not want to care of receiving a physical banknote being worth less than a different banknote of the same denomination nor we do want to care of the possibility of the possession of this same banknote being revoked as it was involved in a robbery some transactions ago\footnote{Though observe that even \euro{} or US\$ or most of the other currencies are not completely fungible, they have serial numbers, but we basically treat them as such because non-fungible solutions for currencies wouldn't work}. The possibility of blacklisting physical banknotes, other than being quite unfeasible, would destroy confidence in receiving them, thus impacting the whole economy. And actually that's not just a matter of practice but has been established by law. Differently from a stolen piece of art, whose possession would be revoked in the same moment of the discovery, that would not be ever the case for physical banknotes in most countries of the world.
\subsection{Bitcoin is weakly fungible}
When speaking of fungibility, what makes discussion on Bitcoin intertwine and compare with that on money in its cash-like forms, rather than with that on its inter-mediated means of payment is Bitcoin's peculiarity to be (substantially) immediate and final payment, exactly like cash. Moreover, inter-mediated means of payment compromise some desirable features of money (among which fungibility itself).\\
Bitcoin turns out to be weakly fungible, which is the other recognized weak point of the protocol. The main reason for it should be found, again, in the transparency of the blockchain (feature and bug), which makes it possible in principle to trace the provenance of every coin and so discern between them. What actually happens is on one side to have some coins which are worth more than others\footnote{Think of freshly minted coins that, being ``clean", can be traded for a higher premium.}, the ones with less value becoming the preferred ones to be exchanged; on the other side, the growth of businesses specialized in the analysis of the transactions flows on the blockchain might turn somebody unwilling to accept certain coins further or exchanges to freeze accounts just for the ``bad history" of a coin.\\
Lack of fungibility could even have more risky consequences for Bitcoin itself. It can jeopardize its permissionless nature because receiving coins and be prevented from spending can make users doubt of whether it's safe to receive and in turn can make them begin to consult blacklist services before transacting again. Or it can lead to a generalized loss of confidence which would make prices drastically decline.\\
Based on the described picture it is evident that the same aspects making Bitcoin non-private make it also non-fungible.\\
Thus among the solutions favouring fungibility we can include the same privacy-based solutions outlined before. Then, another important aspect fungibility benefits from is mining decentralization\footnote{Though note that mining in Bitcoin is quite centralized.} which guarantees that sooner or later a user's transaction will be processed and mined without miners discriminating between coins in the act of processing transactions.
\subsection{Fungibility vs scalability}
Another highly debated aspect in Bitcoin is scalability. It refers to the possibility of increasing the transaction capacity, making the network able to process more transactions per second. In particular, it is in the comparison with centralized payment solutions, such as Visa, that the discussion gets going. The reality is that, by design, Bitcoin is not suited to process the volume of transactions of a centralized circuit like Visa\footnote{According to \url{https://usa.visa.com/run-your-business/small-business-tools/retail.html}, Visa can be able to process 24000 tps at its peak, Bitcoin only 7 tps.} and this for simple reasons: each transaction in Bitcoin is broadcast to and through all the network nodes, each of whom is required to keep an updated copy of the entire ledger of transactions; centralized solutions on the other side only require a centralized ledger to which all transactions are committed and a few backups. If Bitcoin processed the same number of transactions of the Visa circuit this would result in a bloat of the blockchain size, running totally outside the realm of processing power of commercially available computers. \\
Moreover, scalability in Bitcoin is also affected by transactions confirmation being slow and probabilistic compared to centralized systems, where confirmations happen in fractions of a second.\\ Thus, it is likely that higher scalability will mainly come through off-chain solutions exploiting the blockchain for verification of balances (and settlement of disputes, see e.g. \cite{RefWork:18}) rather than transfers.\\
Far from being a discussion on scalability issues and proposed solutions, this paragraph only wants to briefly investigate the connection between fungibility (and privacy) on one side and scalability on the other side. Indeed, the described expensive nature of privacy-based solutions generally put fungibility and scalability in a seemingly insurmountable trade-off. However, there are situations where fungibility helps scalability: the reduction of information leakage (in particular that information enabling transactions to be linked and reducing anonymity) would potentially help scalability by preventing relevant information to go and appear in the blockchain. Mimblewimble \cite{MW} is an example of an application that provides privacy and fungibility (mainly through the adoption of confidential transactions) but even achieves better scalability than Bitcoin by the possibility to remove most of historic data by pruning spent transaction outputs and possibly validating the whole history without downloading these already spent transactions.\\
Conversely, having a more scalable network would obviously favour fungibility and let open the possibility to exploit more expensive privacy-based solutions, but it is indeed difficult to achieve.